<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="Content-Security-Policy" content="default-src * data: gap: content: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
    <script src="components/loader.js"></script>
    <link rel="stylesheet" href="components/loader.css">
    <link rel="stylesheet" href="css/style.css">

    <!-- Firebase SDKã®èª­ã¿è¾¼ã¿ -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="www/config.js"></script>

    <style>
        /* èƒŒæ™¯ç”»åƒã®è¨­å®š */
        body {
            background: linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9)),
                        url('https://images.unsplash.com/photo-1534088568595-a066f410bcda?w=1920&h=1080&fit=crop') center/cover fixed;
            min-height: 100vh;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .app-header h1 {
            margin: 0;
            color: #667eea;
        }

        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-nav {
            padding: 0.5rem 1rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn-nav:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .nav-icon {
            font-size: 1.2rem;
        }

        /* æŠ•ç¨¿æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes sendAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .sending {
            animation: sendAnimation 0.3s ease;
        }
    </style>

    <script>
let postsRef;
let postsListener = null;
let currentEditId = null;
let currentUser = null;

// é€šçŸ¥éŸ³ã‚’å†ç”Ÿã™ã‚‹é–¢æ•°
function playNotificationSound() {
    // Web Audio APIã‚’ä½¿ç”¨ã—ã¦é€šçŸ¥éŸ³ã‚’ç”Ÿæˆ
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    // éŸ³ã®è¨­å®š
    oscillator.frequency.value = 800; // å‘¨æ³¢æ•°
    oscillator.type = 'sine'; // æ³¢å½¢
    
    // éŸ³é‡ã®è¨­å®šï¼ˆãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆï¼‰
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
    
    // å†ç”Ÿ
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.5);
}

// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºå‡¦ç†
function showMessage(message, type = 'success') {
    const messageArea = $('#messageArea');
    messageArea.html(`
        <div class="message ${type}">
            ${message}
        </div>
    `);
    setTimeout(() => {
        messageArea.empty();
    }, 3000);
}

// èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ—¥æœ¬èªåŒ–
function getAuthErrorMessage(error) {
    if (error.code) {
        return `èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼ˆ${error.code}ï¼‰`;
    } else if (error.message) {
        return `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸï¼š${error.message}`;
    } else {
        return 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
    }
}

// æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆã®æ›´æ–°
function updateCharacterCount(inputId, counterId, maxLength) {
    const input = $(`#${inputId}`);
    const counter = $(`#${counterId}`);

    input.on('input', () => {
        const length = input.val().length;
        counter.text(`${length}/${maxLength}`);

        if (length > maxLength) {
            counter.addClass('error');
        } else {
            counter.removeClass('error');
        }
    });
}

// æŠ•ç¨¿å†…å®¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
function validateContent(content) {
    if (!content || !content.trim()) {
        showMessage('æŠ•ç¨¿å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return false;
    }
    if (content.length > 1000) {
        showMessage('æŠ•ç¨¿å†…å®¹ã¯1000æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return false;
    }
    return true;
}

// èªè¨¼ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
function validateAuthInput(email, password, isRegister = false) {
    if (!email || !email.trim()) {
        showMessage('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return false;
    }
    if (!password || !password.trim()) {
        showMessage('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return false;
    }
    if (isRegister && password.length < 6) {
        showMessage('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„', 'error');
        return false;
    }
    return true;
}

// HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†
function escapeHtml(str) {
    if (!str) return '';
    return str
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
}

// ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆç›¸å¯¾æ™‚é–“ï¼‰
function getRelativeTime(timestamp) {
    const now = Date.now();
    const diff = now - timestamp;
    
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(diff / 3600000);
    const days = Math.floor(diff / 86400000);
    
    if (minutes < 1) return 'ãŸã£ãŸä»Š';
    if (minutes < 60) return `${minutes}åˆ†å‰`;
    if (hours < 24) return `${hours}æ™‚é–“å‰`;
    if (days < 7) return `${days}æ—¥å‰`;
    
    // 7æ—¥ä»¥ä¸Šå‰ã¯æ—¥ä»˜è¡¨ç¤º
    const date = new Date(timestamp);
    return date.toLocaleDateString('ja-JP');
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
async function getUserProfile(userId) {
    try {
        const snapshot = await firebase.database()
            .ref(`users/${userId}`)
            .once('value');
        return snapshot.val();
    } catch (error) {
        console.error('Error getting user profile:', error);
        return null;
    }
}

// æŠ•ç¨¿å‡¦ç†
async function createPost(author, content) {
    if (!currentUser) {
        showMessage('æŠ•ç¨¿ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™', 'error');
        return;
    }

    if (!validateContent(content)) return;

    const button = $('#postButton');
    button.prop('disabled', true);
    button.addClass('sending');

    try {
        const userProfile = await getUserProfile(currentUser.uid);
        
        const postData = {
            author: currentUser.email,
            authorDisplayName: userProfile?.displayName || currentUser.email.split('@')[0],
            content: content,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            userId: currentUser.uid
        };

        await postsRef.push(postData);
        
        // é€šçŸ¥éŸ³ã‚’å†ç”Ÿ
        playNotificationSound();
        
        showMessage('æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
        $('#contentInput').val('');
        updateCharacterCount('contentInput', 'contentCount', 1000);
    } catch (error) {
        showMessage('æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸï¼š' + error.message, 'error');
    } finally {
        button.prop('disabled', false);
        button.removeClass('sending');
    }
}

// æŠ•ç¨¿ã®ç·¨é›†æ¨©é™ãƒã‚§ãƒƒã‚¯
function canEditPost(post) {
    return currentUser && post.userId === currentUser.uid;
}

// æŠ•ç¨¿ã®HTMLè¦ç´ ã‚’ç”Ÿæˆ
function createPostElement(post) {
    const canEdit = canEditPost(post);
    const actions = canEdit ? `
        <div class="post-actions">
            <button class="btn-edit" onclick="startEdit('${post.id}')">
                ç·¨é›†
            </button>
            <button class="btn-delete" onclick="deletePost('${post.id}')">
                å‰Šé™¤
            </button>
        </div>
    ` : '';

    return `
        <div class="post" id="post-${post.id}">
            <div class="post-header">
                <span class="post-author">
                    ${escapeHtml(post.authorDisplayName || post.author)}
                </span>
                ${actions}
            </div>
            <div class="post-content">${escapeHtml(post.content)}</div>
            <div class="edit-form">
                <textarea class="form-control" id="edit-${post.id}"></textarea>
                <div class="button-group">
                    <button class="btn-primary" onclick="updatePost('${post.id}')">
                        æ›´æ–°
                    </button>
                    <button class="btn-cancel" onclick="cancelEdit('${post.id}')">
                        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                </div>
            </div>
            <div class="post-footer">
                <span class="post-time">
                    ${getRelativeTime(post.timestamp)}
                </span>
                ${post.updatedAt ? `
                    <span class="post-updated">
                        (ç·¨é›†æ¸ˆã¿)
                    </span>
                ` : ''}
            </div>
        </div>
    `;
}

// æŠ•ç¨¿ã®è¡¨ç¤ºå‡¦ç†
function renderPosts(posts) {
    const postsDiv = $('#postsList');
    postsDiv.empty();

    if (posts.length === 0) {
        postsDiv.html('<p class="no-posts">æŠ•ç¨¿ã¯ã‚ã‚Šã¾ã›ã‚“</p>');
        return;
    }

    posts.forEach((post) => {
        postsDiv.append(createPostElement(post));
    });
}

// æŠ•ç¨¿ã®èª­ã¿è¾¼ã¿
function loadPosts() {
    const sortOrder = $('#sortOrder').val();
    $('#loadingSpinner').show();

    if (postsListener) {
        postsRef.off('value', postsListener);
        postsListener = null;
    }

    postsListener = postsRef.on('value', (snapshot) => {
        const posts = [];
        snapshot.forEach((childSnapshot) => {
            posts.push({
                id: childSnapshot.key,
                ...childSnapshot.val()
            });
        });

        if (sortOrder === 'newest') {
            posts.sort((a, b) => b.timestamp - a.timestamp);
        } else {
            posts.sort((a, b) => a.timestamp - b.timestamp);
        }

        renderPosts(posts);
        $('#loadingSpinner').hide();
    }, (error) => {
        console.error('Data fetch error:', error);
        showMessage('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        $('#loadingSpinner').hide();
    });
}

// ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®é–¢æ•°
function showModal(modalId) {
    $(`#${modalId}`).fadeIn(200);
    $('body').addClass('modal-open');
}

function closeModal(modalId) {
    $(`#${modalId}`).fadeOut(200);
    $('body').removeClass('modal-open');
}

// æ›´æ–°å‡¦ç†ã®ãƒãƒ³ãƒ‰ãƒ©
function handleUpdate() {
    if (!currentEditId) return;

    const content = $('#editContent').val();
    if (!validateContent(content)) return;

    const updates = {
        content: content,
        updatedAt: firebase.database.ServerValue.TIMESTAMP
    };

    postsRef.child(currentEditId).update(updates)
    .then(() => {
        showMessage('æŠ•ç¨¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
        closeModal('editModal');
        animateUpdate(currentEditId);
        currentEditId = null;
    })
    .catch((error) => {
        showMessage('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸï¼š' + error.message, 'error');
    });
}

// å‰Šé™¤å‡¦ç†ã®ãƒãƒ³ãƒ‰ãƒ©
function handleDelete() {
    if (!currentEditId) return;

    const postElement = $(`#post-${currentEditId}`);
    postElement.addClass('deleting');

    postsRef.child(currentEditId).remove()
    .then(() => {
        showMessage('æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        closeModal('deleteModal');
        currentEditId = null;
    })
    .catch((error) => {
        showMessage('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸï¼š' + error.message, 'error');
        postElement.removeClass('deleting');
    });
}

// ç·¨é›†ã®é–‹å§‹
function startEdit(postId) {
    currentEditId = postId;
    const post = $(`#post-${postId}`);
    const content = post.find('.post-content').text();

    $('#editContent').val(content);
    updateCharacterCount('editContent', 'editContentCount', 1000);
    showModal('editModal');
}

// ç·¨é›†ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«
function cancelEdit(postId) {
    const postElement = $(`#post-${postId}`);
    postElement.removeClass('editing');
    postElement.find('textarea').val('');
}

// æŠ•ç¨¿ã®æ›´æ–°
function updatePost(postId) {
    const contentVal = $(`#edit-${postId}`).val();
    if (!validateContent(contentVal)) return;

    const updates = {
        content: contentVal,
        updatedAt: firebase.database.ServerValue.TIMESTAMP
    };

    postsRef.child(postId).update(updates)
    .then(() => {
        showMessage('æŠ•ç¨¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
        $(`#post-${postId}`).removeClass('editing');
        animateUpdate(postId);
    })
    .catch((error) => {
        showMessage('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸï¼š' + error.message, 'error');
    });
}

// æŠ•ç¨¿ã®å‰Šé™¤
function deletePost(postId) {
    currentEditId = postId;
    showModal('deleteModal');
}

// æ›´æ–°æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
function animateUpdate(postId) {
    const post = $(`#post-${postId}`);
    post.addClass('updated');
    setTimeout(() => {
        post.removeClass('updated');
    }, 1000);
}

// ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
function login(email, password) {
    if (!validateAuthInput(email, password)) return;

    const button = $('#loginButton');
    button.prop('disabled', true);

    firebase.auth().signInWithEmailAndPassword(email, password)
    .then(() => {
        showMessage('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');
        clearAuthForm();
    })
    .catch((error) => {
        showMessage(getAuthErrorMessage(error), 'error');
    })
    .finally(() => {
        button.prop('disabled', false);
    });
}

// æ–°è¦ç™»éŒ²å‡¦ç†
function register(email, password) {
    if (!validateAuthInput(email, password, true)) return;

    const button = $('#registerButton');
    button.prop('disabled', true);

    firebase.auth().createUserWithEmailAndPassword(email, password)
    .then(() => {
        showMessage('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ');
        clearAuthForm();
    })
    .catch((error) => {
        showMessage(getAuthErrorMessage(error), 'error');
    })
    .finally(() => {
        button.prop('disabled', false);
    });
}

// ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
function logout() {
    firebase.auth().signOut()
        .then(() => {
            showMessage('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
        })
        .catch((error) => {
            showMessage('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        });
}

// èªè¨¼ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¯ãƒªã‚¢
function clearAuthForm() {
    $('#loginEmail').val('');
    $('#loginPassword').val('');
}

// UIæ›´æ–°
function updateUI(user) {
    if (user) {
        $('.logged-in').show();
        $('.logged-out').hide();
        $('#userEmail').text(user.email);
    } else {
        $('.logged-in').hide();
        $('.logged-out').show();
        $('#userEmail').text('');
    }
}

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã«ç§»å‹•
function goToProfile() {
    if (!currentUser) {
        showMessage('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¦‹ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™', 'error');
        return;
    }
    location.href = 'profile.html';
}

$(function() {
    // Firebaseã®åˆæœŸåŒ–
    try {
        firebase.initializeApp(firebaseConfig);
        console.log("Firebase initialized successfully");
        postsRef = firebase.database().ref('posts');
    } catch (error) {
        console.error("Firebase initialization error:", error);
        showMessage('Firebaseã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }

    // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
    firebase.auth().onAuthStateChanged((user) => {
        currentUser = user;
        updateUI(user);
        loadPosts();
    });

    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã®åˆæœŸåŒ–
    updateCharacterCount('contentInput', 'contentCount', 1000);

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
    $('#postButton').on('click', () => {
        const contentVal = $('#contentInput').val();
        createPost('', contentVal);
    });

    $('#loginButton').on('click', () => {
        const email = $('#loginEmail').val();
        const password = $('#loginPassword').val();
        login(email, password);
    });

    $('#registerButton').on('click', () => {
        const email = $('#loginEmail').val();
        const password = $('#loginPassword').val();
        register(email, password);
    });

    $('#logoutButton').on('click', logout);
    $('#sortOrder').on('change', loadPosts);

    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    $(document).on('click', '.modal-overlay', function(e) {
        if (e.target === this) {
            const modalId = $(this).parent().attr('id');
            closeModal(modalId);
        }
    });

    // ESCã‚­ãƒ¼ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    $(document).on('keydown', (e) => {
        if (e.key === 'Escape') {
            $('.modal:visible').each(function() {
                closeModal(this.id);
            });
        }
    });
});

// ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†
window.addEventListener('unload', () => {
    if (postsListener) {
        postsRef.off('value', postsListener);
        postsListener = null;
    }
});
    </script>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="app-header">
            <h1>ğŸŒ¤ï¸ SNSæ²ç¤ºæ¿</h1>
            <div class="nav-buttons logged-in">
                <button onclick="goToProfile()" class="btn-nav">
                    <span class="nav-icon">ğŸ‘¤</span> ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
                </button>
            </div>
        </div>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="messageArea"></div>

        <!-- èªè¨¼ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³æ™‚è¡¨ç¤ºï¼‰ -->
        <div class="auth-container logged-out">
            <div class="form-group">
                <label for="loginEmail">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" id="loginEmail"
                       class="form-control" placeholder="example@example.com">
            </div>
            <div class="form-group">
                <label for="loginPassword">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="loginPassword"
                       class="form-control" placeholder="6æ–‡å­—ä»¥ä¸Š">
                <small class="help-text">â€»æ–°è¦ç™»éŒ²æ™‚ã¯6æ–‡å­—ä»¥ä¸Š</small>
            </div>
            <div class="button-group">
                <button id="loginButton" class="btn-primary">ãƒ­ã‚°ã‚¤ãƒ³</button>
                <button id="registerButton" class="btn-secondary">æ–°è¦ç™»éŒ²</button>
            </div>
        </div>

        <!-- ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚è¡¨ç¤ºï¼‰ -->
        <div class="user-info logged-in">
            <span>ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š<span id="userEmail"></span></span>
            <button id="logoutButton" class="btn-secondary">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>

        <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ­ã‚°ã‚¤ãƒ³æ™‚è¡¨ç¤ºï¼‰ -->
        <div class="post-form logged-in">
            <div class="form-group">
                <label for="contentInput">æŠ•ç¨¿å†…å®¹</label>
                <textarea id="contentInput" class="form-control"
                          placeholder="ä»Šä½•ã—ã¦ã‚‹ï¼Ÿ"></textarea>
                <small class="character-count" id="contentCount">0/1000</small>
            </div>
            <div class="button-group">
                <button id="postButton" class="btn-primary">ğŸ“® æŠ•ç¨¿ã™ã‚‹</button>
            </div>
        </div>

        <!-- æŠ•ç¨¿ä¸€è¦§ -->
        <div class="posts-container">
            <h2>æŠ•ç¨¿ä¸€è¦§</h2>
            <div class="posts-control">
                <select id="sortOrder" class="form-control">
                    <option value="newest">æ–°ã—ã„é †</option>
                    <option value="oldest">å¤ã„é †</option>
                </select>
            </div>
            <div id="postsList"></div>
            <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                <div class="spinner"></div>
                <p>èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="editModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>æŠ•ç¨¿ã‚’ç·¨é›†</h3>
                <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <textarea id="editContent" class="form-control"></textarea>
                    <small class="character-count" id="editContentCount">0/1000</small>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="handleUpdate()" class="btn-primary">æ›´æ–°</button>
                <button onclick="closeModal('editModal')" class="btn-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ -->
    <div id="deleteModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>æŠ•ç¨¿ã®å‰Šé™¤</h3>
                <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <p>ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ</p>
                <p class="text-danger">ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</p>
            </div>
            <div class="modal-footer">
                <button onclick="handleDelete()" class="btn-danger">å‰Šé™¤</button>
                <button onclick="closeModal('deleteModal')" class="btn-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>
</body>
</html>